## React と WebAudio API, useRef, useEffect

WebAudioAPI のコアロジックは React とは独立。
いつ、どのコンポーネントのライフサイクルで WebAudio の初期化処理などを実行するか。
基本は、特定の React コンポーネントが表示された時に初期化し、不要になった時にクリーンアップしたい。
→ この、コンポーネントのライフサイクルに合わせて処理を行ってくれるのが Hook(useState, useRef, useEffect, etc)。

### React における再レンダリング

useState などで管理している状態が更新されると、React はコンポーネント関数を再実行する。これが再レンダリング。
関数が再実行されるので、関数スコープ内の通常変数は一度削除される。

### Hook（useRef, useState）の出番

ここで、コンポーネントの再レンダリング時に、特定の値を保持したい場合などが問題になる。
再レンダリングを跨いで値を保持したい場合(ex.時間経過で増えていく値を保持したいとき)、useState や useRef などの特別な関数を用いる。
useState や useRef などが返す値は React 自体がコンポーネントの外側で管理・保持しているため、コンポーネント関数が再実行されても、値が保持される。

### useState, useRef

useRef は再レンダリングの影響を受けずに値を保持し続けるための箱みたいな感じ。
useState との違いは、useRef の値(current プロパティ)を変更しても再レンダリングを引き起こさない点。
UI の表示に関係ない値(WebAudio API の AudioContext)を、再レンダリングを跨いで保持したい場合に便利。

### useEffect

ここまで来て、WebAudio API の初期化処理をどこに書くのかという問題がある。WebAudio API の値は際レンダリングを跨いで保持できるけど、関数コンポーネント内で普通に初期化処理をしたら、結局再レンダリング時にまた初期化されてしまう。
また、関数外で初期化処理をした場合はそのコンポーネントが使われていなくても無駄な AudioContext が作られてしまうし、コンポーネントが不要になった時にクリーンアップが難しくなる。
コンポーネントの際レンダリングとは無関係に、コンポーネントのライフサイクルの中で一度だけ初期化処理をしたい。
→useEffect の出番。

useEffect(関数を返す関数、配列)
配列で指定されたタイミングで関数が実行され、コンポーネントが不要になった時に関数で return された関数が実行される。

### useCallback

レンダー間で関数の定義をキャッシュしてくれる。
ある値に依存して計算結果が変わる関数がある場合、その値が変更されていないのに、レンダー毎に関数の中身を再計算すると非効率なことがある。
useCallback でキャッシュすれば無駄な再計算を省ける！  
例えば

- useAudioEngine.ts の noteOn 関数。noteOn は oscillatorType が変更されない限り、その挙動は変わらないが、普通に実装するとコンポーネントが再レンダーされるたびにオシレータの初期化がされてしまう。callBack で実装すれば、oscillatorType が変更された場合のみオシレーターを再初期化するように実装できる

### Custom Hook

自分で Hook を作れる。 useCustomHook(CustomHook は任意の名前)とすれば、react がその関数を Hook だと認識する。
Custom Hook 内では React の組み込みの Hook が扱える(通常の関数内では React Hook は利用できない)。React の状態に依存する関数や、他のフックなどと連携する必要のあるロジックをカプセル化できるのがすごい便利。

- webAudioAPI の初期化や、値の変更などは React の状態やコンポーネントのライフサイクル(初期化、際レンダリング、State の変更)などに依存するので、ロジックを分離する際には Custom Hook を作成すると都合がいい。

### Zustandで配列を書き換えるとき
 参考：[state 内の配列の更新](https://ja.react.dev/learn/updating-arrays-in-state)
 書き換える系の関数は使っちゃダメ。配列はreadonly
 新しい配列を作って再代入が基本。mapとか。

## 減算方式シンセサイザーの機能要件

1. 音源部
    -　ボイシング
        - モノフォニック
        - ポリフォニック
   - オシレーター
     - 波形選択(Sine, Square, Sawtooth, Triangle)
     - オクターブ切り替え
     - ファインチューン(細かい音程調節)
2. 音加工
   - フィルターセクション
     - ローパスフィルター/ハイパスフィルター
     - カットオフ周波数の制御
     - (レゾナンス) ->　理解度浅いのでできれば実装する程度
3. 音量制御
   - エンベロープ
     - ADSR での音量制御
   - マスターボリューム
4. モジュレーション
   - フィルターエンベロープ(フィルターのカットオフ周波数の時間変化を制御する ADSR エンベロープ)
   - LFO
     - 波形選択(Triangle, Square, Sine)
     - 周期の調整
     - 適用先(オシレーターのピッチ、フィルターカットオフ周波数)
5. 入出力
   - 入力
     - キーボード入力
     - MIDI 入力
   - オーディオ出力
     - 最終的にはステレオ出力したい。

### LFO、Envelopeを任意の値に対してかけられるようにしたい。
基本的にSliderで変更できる値は、全部LFO,Envelopeをかけられる。
ModAssignablevalueみたいなインターフェース作るか？

## Material UI

UI について  
・オシレーターセクション  
・フィルターセクション  
・エンベロープセクション  
・モジュレーションセクション

スライダーやノブなどで直感的に操作できるようにしたい

